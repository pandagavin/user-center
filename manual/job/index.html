<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>03.作业提交 | 中芯超算</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="中芯超算 | 用户中心">
    <meta name="keywords" content="中芯，计算, super computer, HPC,超算,软件,技术博客,高性能计算,技术文档,学习,用户手册,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.622c65b1.css" as="style"><link rel="preload" href="/assets/js/app.001d7717.js" as="script"><link rel="preload" href="/assets/js/2.f6aa4a05.js" as="script"><link rel="preload" href="/assets/js/7.29ca4f21.js" as="script"><link rel="prefetch" href="/assets/js/10.e0eeffcd.js"><link rel="prefetch" href="/assets/js/11.52af2a85.js"><link rel="prefetch" href="/assets/js/3.6bc1ffdc.js"><link rel="prefetch" href="/assets/js/4.8e727303.js"><link rel="prefetch" href="/assets/js/5.9658f818.js"><link rel="prefetch" href="/assets/js/6.fb7b10cb.js"><link rel="prefetch" href="/assets/js/8.321cdc38.js"><link rel="prefetch" href="/assets/js/9.eed81b5f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.622c65b1.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/avatar.jpg" alt="中芯超算" class="logo"> <span class="site-name can-hide">中芯超算</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/manual/system/" class="nav-link">用户手册</a></div><div class="nav-item"><a href="/get-started/wrf/" class="nav-link">快速入门</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/manual/system/" class="nav-link">用户手册</a></div><div class="nav-item"><a href="/get-started/wrf/" class="nav-link">快速入门</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/manual/system/" class="sidebar-link">01.系统概述</a></li><li><a href="/manual/use/" class="sidebar-link">02.使用方式</a></li><li><a href="/manual/job/" aria-current="page" class="active sidebar-link">03.作业提交</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/manual/job/#作业提交" class="sidebar-link">作业提交</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/manual/job/#使用限制" class="sidebar-link">使用限制</a></li><li class="sidebar-sub-header"><a href="/manual/job/#状态查看命令" class="sidebar-link">状态查看命令</a></li><li class="sidebar-sub-header"><a href="/manual/job/#提交作业" class="sidebar-link">提交作业</a></li><li class="sidebar-sub-header"><a href="/manual/job/#作业提交举例" class="sidebar-link">作业提交举例</a></li><li class="sidebar-sub-header"><a href="/manual/job/#作业取消" class="sidebar-link">作业取消</a></li></ul></li></ul></li><li><a href="/manual/support/" class="sidebar-link">04.技术支持</a></li><li><a href="/manual/update/" class="sidebar-link">更新日志</a></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><span data-v-1cd794fe>用户手册</span></li> <!----> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/pandagavin" target="_blank" title="作者" class="beLink" data-v-1cd794fe>pandagavin</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2020-11-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          03.作业提交
        </h1>  <div class="theme-vdoing-content content__default"><h2 id="作业提交"><a href="#作业提交" class="header-anchor">#</a> 作业提交</h2> <p>在系统中，所有在计算结点中运行的串行或并行应用程序，都必须通过资源管理系统来提交运行。资源管理系统首先将用户提交的应用程序构造成作业进行排队处理，然后根据系统的实时运行资源状态，决定何时以及在哪些计算结点中加载应用程序的运行，不同的应用程序之间不存在资源的竞争冲突，用户也可以通过作业管理系统来监控应用程序的运行。</p> <h3 id="使用限制"><a href="#使用限制" class="header-anchor">#</a> 使用限制</h3> <p>为了保证系统资源的高效使用，用户请求的快速响应，系统的稳定性，在系统中做出了相应的使用限制，相关限制如下：</p> <h4 id="登陆限制"><a href="#登陆限制" class="header-anchor">#</a> 登陆限制</h4> <h5 id="密码过期保护"><a href="#密码过期保护" class="header-anchor">#</a> 密码过期保护</h5> <p>系统已开启密码过期保护，密码最长过期时间为 <code>180</code> 天，在密码过期前会有即将过期的提示（提前 <code>14</code> 天提醒），密码过期后无法登陆，请联系管理员。</p> <h5 id="密码错误锁定保护"><a href="#密码错误锁定保护" class="header-anchor">#</a> 密码错误锁定保护</h5> <p>系统已开启密码错误保护，当用户输入密码错误次数超过 <code>3</code> 次后，系统会禁止用户登陆，锁定时间为 <code>5</code>分钟 。在锁定期间，如果再次登陆（无论密码输入正确或者错误，都无法登陆成功，并刷新最后登陆时间）。请输入错误后，等待 <code>5</code> 分钟后再尝试。如果错误次数过多可能会导致账号锁死，需要联系管理员进行账号解锁。</p> <h4 id="计算分区限制"><a href="#计算分区限制" class="header-anchor">#</a> 计算分区限制</h4> <p>系统可根据用户的使用情况，对所有计算资源进行分区。不同分区针对不同的用户群体开放使用，用户可以使用使用 <code>sinfo</code> 命令，看到相应的分区限制信息，例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zhang3@ln0 ~<span class="token punctuation">]</span>$ sinfo
PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST
batch*       up   infinite     <span class="token number">19</span>   idle cn<span class="token punctuation">[</span><span class="token number">1</span>-19<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li>PARTITION 表示计算分区（带有 <code>*</code> 的计算分区表示默认分区，即提交运行作业时，不指定 <code>-p</code> 参数时，使用的默认分区）</li> <li>AVAIL 表示分区状态：up 开启 / down 关闭</li> <li>TIMELIMIT 表示该分区的时间限制：格式为 <code>天-时:分:秒</code>，如果是 <code>infinite</code> 表示没有时间限制</li> <li>NODES 表示结点数</li> <li>STATE 表示结点运行状态：down 表示未启动 / idle 表示启动后处于空闲状态 / allocated 表示结点已经分配作业</li> <li>NODELIST 为结点列表</li></ul> <p>根据用户所在的共享存储不同以及权限不同，能够使用的计算分区也不相同，具体如下表所示：</p> <p><em>表5 用户分区限制</em></p> <table><thead><tr><th style="text-align:center;">分区名称</th> <th style="text-align:center;">分区含义</th> <th style="text-align:center;">运行时间(h)</th> <th style="text-align:center;">使用权限</th></tr></thead> <tbody><tr><td style="text-align:center;">batch</td> <td style="text-align:center;">包机时用户分区</td> <td style="text-align:center;">无</td> <td style="text-align:center;">由账号权限决定</td></tr> <tr><td style="text-align:center;">其他分区</td> <td style="text-align:center;">用户专有分区</td> <td style="text-align:center;">由账号权限决定</td> <td style="text-align:center;">由账号权限决定</td></tr></tbody></table> <p>所有分区均可以设定相应允许的用户队列，目前分区为所有用户均可以使用；根据用户的不同分类，划分不同的资源，用户如果看不到某些分区，是因为该用户不具备相应的资源使用权限。</p> <p><strong>注意：</strong></p> <ol><li>由于大型集群系统具备一定故障率，为了保证系统稳定性，部分计算分区中有限定任务执行时间的限制，因此建议用户为程序设立“断点”从而保证任务由于意外中断后，可以继续运算。</li> <li>目前系统对用户所设置的计算分区，均为共享分区，所有用户共享该分区资源。若用户需要独占资源，请提出申请。</li></ol> <h4 id="提交作业限制"><a href="#提交作业限制" class="header-anchor">#</a> 提交作业限制</h4> <ul><li><p>根据用户的申请情况，针对用户的作业相关配置进行了限制，包括：最多可以使用的结点数、最多可以使用的核数、单个任务最多可以使用的结点数、单个任务最多可以使用的核数等。</p></li> <li><p>通过命令<code>sacctres</code>可查看自己账号的具体权限设置。用户只有查看自己账号的权限，无查询其他账号的权限。</p></li> <li><p>用户在使用过程中，如果有超出自己合同范围内的计算规模的计算需求，请基于自己的需求，向管理员提出申请，管理员会根据用户需要审查后，进行一定的修改。</p></li> <li><p>为了保证系统和用户数据的安全，目前普通用户不能在没有申请资源时，就 <code>ssh</code> 链接到计算结点，只有分配了相应的计算结点资源后，才能 <code>ssh</code> 到指定计算结点。</p></li></ul> <p>举例如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zhang3@ln0 /<span class="token punctuation">]</span>$ sacctres
   Cluster    Account       User  Partition              GrpTRES GrpSubmit GrpJobs
---------- ---------- ---------- ---------- -------------------- --------- -------
     linux      zhang3                           <span class="token assign-left variable">cpu</span><span class="token operator">=</span><span class="token number">800</span>,node<span class="token operator">=</span><span class="token number">10</span>        <span class="token number">10</span>      <span class="token number">10</span>
     linux      zhang3    zhang3      batch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数说明：</p> <ul><li><p>Cluster 集群名</p></li> <li><p>Account 账号所属组</p></li> <li><p>User 账号名</p></li> <li><p>Partition 计算分区</p></li> <li><p>GrpTRES 最大使用资源数</p></li> <li><p>GrpSubmitJobs 最大提交作业数</p></li> <li><p>GrpJobs  最大运行作业数</p></li></ul> <p>用户同样可以查看到自己的限制，也可以根据后面的需要向管理员提出申请，管理员会根据用户需要重新修改限制。</p> <blockquote><p>为了保证系统和用户数据的安全，目前普通用户不能在没有申请资源时，就 <code>ssh</code> 链接到计算结点，只有分配了相应的计算结点资源后，才能 <code>ssh</code> 到指定计算结点。</p></blockquote> <h4 id="磁盘配额限制"><a href="#磁盘配额限制" class="header-anchor">#</a> 磁盘配额限制</h4> <p>为了合理利用有限的存储资源，目前对用户默认进行存储软限制 <code>500GB</code>，存储硬限制 <code>1TB</code>，文件数软限制 <code>100 万</code>，文件数硬限制 <code>200 万</code> 的磁盘配额限制。</p> <p>登陆系统后，通常就会显示该用户所属group（即用户组）的存储情况：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Disk quotas <span class="token keyword">for</span> group zhang3 <span class="token punctuation">(</span>gid <span class="token number">1000</span><span class="token punctuation">)</span>:     
  Filesystem    used    <span class="token function">quota</span>  limit   grace    files      <span class="token function">quota</span>   limit   grace
       /work    256G     500G    1T               <span class="token number">123</span>    <span class="token number">1000000</span>  <span class="token number">2000000</span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>关键词说明：</p> <ul><li>Filesystem 用户所在的共享分布式存储</li> <li>used 用户目前已经使用的存储</li> <li>quota 存储软限制</li> <li>limit  存储硬限制</li> <li>grace  存储状态，默认为空</li> <li>files 用户已用文件数</li> <li>quota 文件数软限制</li> <li>limit 文件数硬限制</li> <li>grace 文件数状态，默认为空</li></ul> <p>用户可以使用命令查询查询用户组或用户的配额限制，查询命令为：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查询用户组</span>
<span class="token function">quota</span> -h -g zhang3 
<span class="token comment"># 查询用户</span>
<span class="token function">quota</span> -h -u zhang3 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>命令参数说明：<code>quota</code> 是配额查询命令， <code>-h</code> 是人性化显示查询结果， <code>-g</code> 查询用户组， <code>-u</code> 查询用户。</p> <blockquote><p>Tips：</p> <ol><li>存储是有配额限制的：
<ul><li>超出软限制，开启倒计时，倒计时到期就用不了了；</li> <li>超出硬限制，直接就用不了了。</li></ul></li> <li>如果默认免费配额不够用，需要增加配额，请联系管理员。</li></ol></blockquote> <h3 id="状态查看命令"><a href="#状态查看命令" class="header-anchor">#</a> 状态查看命令</h3> <p>在用户提交作业前，应查看系统的使用情况，这样利于用户根据系统使用情况，对相应的计算结点进行选择。</p> <h4 id="节点状态查看"><a href="#节点状态查看" class="header-anchor">#</a> 节点状态查看</h4> <p>用户可以使用 <code>sinfo</code> 命令查看结点的使用情况，从而根据情况做出选择。例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zhang3@ln0 ~<span class="token punctuation">]</span>$ sinfo
PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST
batch*       up   infinite     <span class="token number">19</span>   idle cn<span class="token punctuation">[</span><span class="token number">1</span>-19<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>参数说明：</strong></p> <ul><li>PARTITION 表示计算分区（带有 <code>*</code> 的计算分区表示默认分区，即提交运行作业时，不指定 <code>-p</code> 参数时，使用的默认分区）</li> <li>AVAIL 表示分区状态
<ul><li>up 开启</li> <li>down 关闭</li></ul></li> <li>TIMELIMIT 表示该分区的时间限制：格式为 <code>天-时:分:秒</code>，如果是 <code>infinite</code> 表示没有时间限制</li> <li>NODES 表示结点数</li> <li>STATE 表示结点运行状态
<ul><li>down 表示未启动</li> <li>idle 表示启动后处于空闲状态</li> <li>allocated 表示结点已经分配作业</li></ul></li> <li>NODELIST 为结点列表</li></ul> <h4 id="作业状态查看"><a href="#作业状态查看" class="header-anchor">#</a> 作业状态查看</h4> <p>用户可以使用  <code>squeue</code> 命令查看系统中各计算结点的运行情况，例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>zhang3@ln0 ~<span class="token punctuation">]</span>$ squeue
             JOBID PARTITION     NAME     <span class="token environment constant">USER</span> ST       TIME  NODES NODELIST<span class="token punctuation">(</span>REASON<span class="token punctuation">)</span>
                 <span class="token number">9</span>     batch   sub.sh    gavin PD       <span class="token number">0</span>:00      <span class="token number">2</span> <span class="token punctuation">(</span>Resources<span class="token punctuation">)</span>
                <span class="token number">10</span>     batch  wrf.exe    gavin  R       <span class="token number">0</span>:06      <span class="token number">2</span> cn<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span>
                <span class="token number">11</span>     batch     <span class="token function">bash</span>    gavin  R       <span class="token number">0</span>:12      <span class="token number">2</span> cn<span class="token punctuation">[</span><span class="token number">3</span>-4<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数说明：</p> <ul><li>JOBID 表示任务 ID</li> <li>Name 表示任务名称</li> <li>USER 为用户</li> <li>ST 为作业状态（PD 排队；R 运行）</li> <li>TIME 为已运行时间</li> <li>NODES表示占用结点数</li> <li>NODELIST 为任务运行的结点列表（未运行的作业会给出排队原因）</li></ul> <p>用户可以使用 <code>squeue</code> 查看自己提交的作业，为了保证用户的数据安全，普通用户通过 <code>squeue</code>只能看到自己提交的作业。</p> <p>用户可以通过 <code>scontrol</code> 命令来查看自己提交的作业明细，语法格式为 <code>scontrol show jobs jobid</code>（其中：jobid替换为实际的作业编号），例如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>gavin@cn1 ~<span class="token punctuation">]</span>$ scontrol show jobid <span class="token number">1</span>
<span class="token assign-left variable">JobId</span><span class="token operator">=</span><span class="token number">1</span>  <span class="token assign-left variable">JobName</span><span class="token operator">=</span>sub.sh
   <span class="token assign-left variable">UserId</span><span class="token operator">=</span>zhang3<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token assign-left variable">GroupId</span><span class="token operator">=</span>zhang3<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token assign-left variable">MCS_label</span><span class="token operator">=</span>N/A
   <span class="token assign-left variable">Priority</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">Nice</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">Account</span><span class="token operator">=</span>zhang3 <span class="token assign-left variable">QOS</span><span class="token operator">=</span>normal <span class="token assign-left variable">WCKey</span><span class="token operator">=</span>*hpc
   <span class="token assign-left variable">JobState</span><span class="token operator">=</span>RUNNING <span class="token assign-left variable">Reason</span><span class="token operator">=</span>None <span class="token assign-left variable">Dependency</span><span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
   <span class="token assign-left variable">Requeue</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">Restarts</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">BatchFlag</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">Reboot</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ExitCode</span><span class="token operator">=</span><span class="token number">0</span>:0
   <span class="token assign-left variable">RunTime</span><span class="token operator">=</span>00:00:10 <span class="token assign-left variable">TimeLimit</span><span class="token operator">=</span>UNLIMITED <span class="token assign-left variable">TimeMin</span><span class="token operator">=</span>N/A
   <span class="token assign-left variable">SubmitTime</span><span class="token operator">=</span><span class="token number">2021</span>-07-17T22:15:33 <span class="token assign-left variable">EligibleTime</span><span class="token operator">=</span><span class="token number">2021</span>-07-17T22:15:33
   <span class="token assign-left variable">AccrueTime</span><span class="token operator">=</span>Unknown
   <span class="token assign-left variable">StartTime</span><span class="token operator">=</span><span class="token number">2021</span>-07-17T22:15:33 <span class="token assign-left variable">EndTime</span><span class="token operator">=</span>Unknown <span class="token assign-left variable">Deadline</span><span class="token operator">=</span>N/A
   <span class="token assign-left variable">SuspendTime</span><span class="token operator">=</span>None <span class="token assign-left variable">SecsPreSuspend</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">LastSchedEval</span><span class="token operator">=</span><span class="token number">2021</span>-07-17T22:15:33
   <span class="token assign-left variable">Partition</span><span class="token operator">=</span>batch AllocNode:Sid<span class="token operator">=</span>cn1:56233
   <span class="token assign-left variable">ReqNodeList</span><span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> <span class="token assign-left variable">ExcNodeList</span><span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
   <span class="token assign-left variable">NodeList</span><span class="token operator">=</span>cn<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span>
   <span class="token assign-left variable">BatchHost</span><span class="token operator">=</span>cn1
   <span class="token assign-left variable">NumNodes</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">NumCPUs</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">NumTasks</span><span class="token operator">=</span><span class="token number">2</span> CPUs/Task<span class="token operator">=</span><span class="token number">1</span> ReqB:S:C:T<span class="token operator">=</span><span class="token number">0</span>:0:*:*
   <span class="token assign-left variable">TRES</span><span class="token operator">=</span>cpu<span class="token operator">=</span><span class="token number">2</span>,node<span class="token operator">=</span><span class="token number">2</span>,billing<span class="token operator">=</span><span class="token number">2</span>
   Socks/Node<span class="token operator">=</span>* NtasksPerN:B:S:C<span class="token operator">=</span><span class="token number">0</span>:0:*:* <span class="token assign-left variable">CoreSpec</span><span class="token operator">=</span>*
   <span class="token assign-left variable">MinCPUsNode</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">MinMemoryNode</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">MinTmpDiskNode</span><span class="token operator">=</span><span class="token number">0</span>
   <span class="token assign-left variable">Features</span><span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> <span class="token assign-left variable">DelayBoot</span><span class="token operator">=</span>00:00:00
   <span class="token assign-left variable">OverSubscribe</span><span class="token operator">=</span>OK <span class="token assign-left variable">Contiguous</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">Licenses</span><span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span> <span class="token assign-left variable">Network</span><span class="token operator">=</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span>
   <span class="token assign-left variable">Command</span><span class="token operator">=</span>sleep
   <span class="token assign-left variable">WorkDir</span><span class="token operator">=</span>/work/home/zhang3
   <span class="token assign-left variable">Power</span><span class="token operator">=</span>
   NtasksPerTRES:0

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><blockquote><p>Tips： 使用 <code>scontrol</code> 命令可以看到详细的作业信息，具体函数不在赘述</p></blockquote> <h3 id="提交作业"><a href="#提交作业" class="header-anchor">#</a> 提交作业</h3> <p>目前系统部署的资源管理系统包括多种作业提交方式，交互作业提交方式  <code>srun</code> ，批处理作业提交方式 <code>sbatch</code>  和分配模式 <code>salloc</code>。作业终止方式为 <code>sancel</code>命令，需要获取作业的 <code>jobid</code>，如前所述，<code>jobid</code> 可以通过 <code>squeue</code> 命令查看获得。</p> <p>系统中作业的运行分成两步：资源分配与任务加载。</p> <p>对于不同的作业提交方式，基本流程如下：</p> <ul><li><p>对于批处理作业，使用 <code>sbatch</code> 命令提交作业脚本，作业被调度运行后，在所分配的首个结点上执行作业脚本，在作业脚本中使用 <code>srun</code> 命令加载作业任务。</p></li> <li><p>对于交互式作业，资源分配与任务加载两步均通过 <code>srun</code> 命令进行：当在登录 shell 中执行 <code>srun</code>  命令时， <code>srun</code> 首先向系统提交作业请求并等待资源分配，然后在所分配的结点上加载作业任务。</p></li> <li><p>对于分配模式作业，使用 <code>salloc</code> 命令向系统提交作业请求并等待资源分配，获得结点资源后返回。然后再使用 <code>srun</code> 命令在所分配的结点上加载作业任务。</p></li></ul> <blockquote><p>为了简化和方便用户，只对相关命令做简单介绍，用户如需更多参数选择，可通过相应命令后加入<code>--help</code> 的方式，获取帮助信息，从而满足用户需求。</p></blockquote> <h4 id="交互式作业提交"><a href="#交互式作业提交" class="header-anchor">#</a> 交互式作业提交</h4> <p><code>srun</code> 命令运行的主要格式如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>srun <span class="token punctuation">[</span>options<span class="token punctuation">]</span> program 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>srun</code> 包括多个选项，用户最常使用的选项如下：</p> <ul><li>-n, --ntasks=ntasks  指定要运行的进程数。请求 srun分配/加载 ntasks 个进程。省缺的情况是每个 CPU 运行一个进程，但是 -c 参数将改变此省缺值。</li> <li>-N, --nodes=minnodes[-maxnodes]  请求为此作业至少分配 minnodes 个结点。调度器可能决定在多于 minnodes 个结点上启动作业。可以通过指定 maxnodes 限制最多分配的结点数，如“--nodes=2-4”。最少和最多结点数可以相同以便指定确切的结点数，如“--nodes=2-2”将请求两个并且仅仅两个结点。如果没有指定-N，省缺的行为是分配足够的结点以满足-n 选项的要求。</li> <li>-p, --partition=partition 从分区 partition 请求资源。如未指定，则省缺为默认分区。</li> <li>-t, --time=minutes 设置作业的运行时间限制为 minutes 分钟。省缺值为分区的时间限制值。当到达时间限制时，作业的进程将被发送 SIGTERM 以及 SIGKILL 信号终止执行。</li> <li>-D, --chdir=path 加载的作业进程在执行前将工作目录改变到 path 。省缺情况下作业 srun进程的当前工作目录。</li> <li>-l, --label 在标准输出/标准错误的每行之前添加任务号。通常，远程任务的标准输出和标准错误通过行缓冲直接传递到 srun的标准输出和标准错误。--label 选项将在每行输出前面添加远程任务的 ID。</li> <li>-J, --job-name=jobname 指定作业的名字。省缺值是可执行程序的名字 program 。</li> <li>-W, --wait=seconds 指定在第一个任务退出后，到终止所有剩余任务之前的等待时间。0 表示无限等待（60 秒后将发出一个警告）。省缺值可由系统配置文件中的参数设置。此选项用于确保作业在一个或多个任务提前退出时能够及时终止。</li> <li>-w, --nodelist=nodelist|filename 请求指定列表中的结点。分配给作业的将至少包含这些结点。nodelist 可以是逗号分割的结点列表或范围表达式（如 cn[1-5,7,12]）。如果包含“/”字符，则 nodelist 将会被当作是一个文件名，其中包含了所请求的结点列表。</li> <li>-x, --execlude=nodelist|filename 排除指定列表中的结点。分配给作业的将不会包含这些结点。</li> <li>--exclusive 此作业不能与其它运行的作业共享结点，加入此选项，则表示用户需要针对此作业使用独占的处理器，如果没有足够的处理器，则作业的启动将会被推迟。</li></ul> <blockquote><p>Tips以上选项中，由以 <code>-N</code> ，<code>-n</code>，<code>-p</code>，<code>-w</code>，<code>-x</code> 等选项最常用，<code>-N</code> 指定结点数，<code>-n</code> 指定进程数，<code>-p</code> 指定分区名，<code>-w</code> 指定结点列表，<code>-x</code> 指定不参加分配的结点列表（用于排除自己认为有问题的结点）。</p></blockquote> <p>系统的资源使用 <strong>非抢占式调度方式</strong>，即作业如果没有占满结点，则如有别的作业提出需求，若剩余资源合适，也会将资源分配给新的作业。例如一个作业占用了一个结点的 <code>4</code> 核，另外有新的作业也需要 <code>4</code> 核，则该作业也会分配在该结点上。</p> <p><strong>特别注意：</strong></p> <ol><li><p><code>srun</code> 基本可以替代 <code>mpirun</code> ，特别是使用 <code>Intel IMPI</code> 编译的程序，完全可以使用 <code>srun</code> 提交任务，而不需使用 <code>mpirun</code>。</p></li> <li><p><code>srun</code> 为交互式作业提交方式，用户如需要和程序进行交互，则选择直接使用 <code>srun</code> 提交任务，如果不需要交互，则需使用批处理作业提交方式。</p></li> <li><p><code>srun</code> 提交的任务，如果没有进行输入输出的重定向，在关闭登陆客户端软件时，会导致任务中断，因此如无特殊需要，请直接使用 <code>srun</code> 提交任务时，重定向输入输出，并保留相应的 <code>log</code> 文件，方便遇到问题时，技术人员及时解决。</p></li></ol> <p>重定向举例如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>srun –p batch –N 2 –n 160 ./a.out &gt;log 2&gt;&amp;1 &amp; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明：<code>&gt;</code> 为重定向符号，<code>2&gt;&amp;1</code> 表示标准错误输出重定向至标准输出，最后的 <code>&amp;</code> 表示后台提交方式，这样保证了该任务在登陆客户端关闭时依然保持不中断。</p> <blockquote><p>Tips：再次提示，为了保证任务的稳定性，如无特殊需要请使用批处理作业提交方式</p></blockquote> <h4 id="批处理作业提交"><a href="#批处理作业提交" class="header-anchor">#</a> 批处理作业提交</h4> <p>由于交互需求，才考虑直接使用 <code>srun</code> 提交任务。如无交互需求，或不能直接使用 <code>srun</code> 提交任务，请使用批处理作业提交任务。</p> <p>批处理作业是指用户编写作业脚本，指定资源需求约束，然后作为作业提交。提交批处理作业的命令为 <code>sbatch</code> ，用户提交命令后即执行结束，返回命令行窗口，但此时作业在进行排队调度，在资源需求被满足是，分配完计算结点之后，系统将在所分配的第一个计算结点上加载执行用户的作业脚本。</p> <p>批处理作业使用 <code>sbatch</code> 命令提交，用户在 <code>sbatch</code> 的参数中指定资源分配的需求约束，编写的作业脚本中，也可以使用 <code>srun</code> 命令加载计算作业，此时 srun通过环境变量感知已经分配了资源，从而直接创建作业而不再次提交作业。</p> <p>批处理作业的脚本为一个文本文件，脚本第一行以 <code>#!</code>字符开头，并制定脚本文件的解释程序，如 <code>sh</code>，<code>bash</code>，<code>rsh</code> ，<code>csh</code> 等。</p> <p>这种作业提交方式，适合那些需要指定资源，且带有自己执行命令的计算作业，或者需要连续执行多个任务的作业，用户可以在脚本中提交多个任务，逐个计算。</p> <p>计算完成后，工作目录中会生成以 <code>slurm</code> 开头的 <code>.out</code> 文件为输出文件。</p> <p>如前所述，系统中作业的运行分成两步：资源分配与任务加载。批处理作业使用 <code>sbatch</code> 提交脚本的方式运行，<code>sbatch</code> 负责资源分配，<code>sbatch</code> 获取资源后，会在获取资源的第一个结点运行提交的脚本。</p> <blockquote><p><code>sbatch</code> 包含多个选项，基本和 <code>srun</code> 类似，用户可以通过 <code>sbatch --help</code> 命令查看相应所需参数。</p></blockquote> <p><strong>举例一：</strong></p> <p>用户的脚本为 <code>sub.sh</code> 如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash </span>
srun -n <span class="token number">16</span> –p batch –w cn<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span> <span class="token function">hostname</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>根据该脚本用户提交批处理作业，需要明确申请的资源为 <code>batch</code> 分区的结点 <code>cn[1-2]</code>，因此用户提交如下的批处理命令即可：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch –p batch –w cn<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span> ./mybash.sh 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>TIps：此时注意，给文本文件可执行权限，利用 chmod 命令，使用为：chmod +x filename（其中 filename 替换为你需要修改的文件名。）</p></blockquote> <p><strong>举例二 :</strong></p> <p><code>sbatch</code> 提交的脚本中即可以包含 <code>srun</code>，也可以支持 <code>mpirun</code> 等提交作业方式。</p> <p>例如，希望使用 <code>mpirun</code> 命令运行可执行程序 <code>a.out</code>，需要运行在结点 <code>cn1-cn10</code>，共计 <code>10</code> 个结点  <code>800</code> 个进程。则可以撰写脚本 sub.sh 如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash </span>
srun -N <span class="token number">10</span> -n <span class="token number">800</span> <span class="token function">hostname</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">&gt;</span> hostfile
mpirun –hostfile hostfile –np <span class="token number">800</span> ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>TIps：第二行是创建供 <code>mpirun</code> 命令使用的 hostfile文件。</p></blockquote> <p>用户根据该脚本（chmod 修改该脚本可执行权限 chmod +x sub.sh），提交批处理命令如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch –N <span class="token number">10</span> -n <span class="token number">800</span> –p batch –w cn<span class="token punctuation">[</span><span class="token number">1</span>-10<span class="token punctuation">]</span> ./sub.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>特别提示：</p> <blockquote><p>Tips：批处理作业提交模式，试用范围很广，由于手册篇幅限制，不能详述，如果您在提交批处理作业的过程中遇到了任何问题，请联系管理员。</p></blockquote> <h4 id="分配模式作业提交"><a href="#分配模式作业提交" class="header-anchor">#</a> 分配模式作业提交</h4> <p>分配作业模式类似于，交互式作业模式和批处理作业模式的融合。用户需要指定资源分配的需求条件，向资源管理器提出作业的资源分配请求。作业排队，当用户请求资源被满足时，将在用户提交作业的结点上，执行用户所指定的命令，指定的命令执行结束后，也运行结束，用户申请的资源被释放。</p> <p><code>salloc</code> 后面如果没有跟定相应的脚本或可执行文件，则默认选择了<code>/bin/sh</code>，用户获得了一个合适环境变量的 <code>shell</code>  环境。</p> <p><code>salloc</code> 和 <code>sbatch</code> 最主要的区别是，<code>salloc</code>命令资源请求被满足时，直接在提交作业的结点执行相应任务。而 sbatch则当资源请求被满足时，在分配的第一个结点上执行相应任务。</p> <p><code>salloc</code> 在分配资源后，再执行相应的任务，很适合需要指定运行结点，和其它资源限制，并有特定命令的作业。</p> <p><code>salloc</code> 包含多个选项，基本和 <code>srun</code> 类似，用户可以通过 <code>salloc--help</code> 命令查看相应所需参数。</p> <p><strong>举例：</strong></p> <p>比如<code>zhang3</code> 用户需要 <code>2</code> 个结点，<code>160</code> 个进程，利用 <code>salloc</code> 进行提交方式。</p> <p>首先申请资源，执行如下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>salloc –N <span class="token number">2</span> –n <span class="token number">160</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过 <code>squeue</code> 查看相应的 jobID 为 <code>1</code>，结点为 <code>cn[1-2]</code>,则用户可以选择如下方式：</p> <div class="language-basj line-numbers-mode"><pre class="language-text"><code>ssh cn1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>切换到 <code>cn1</code>  结点，之后执行如下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mpirun -machines cn1:80:cn2:80 ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><ol><li><p><code>salloc</code>和 <code>sbatch</code>的使用方法类似，主要区别为任务加载点不同，<code>salloc</code> 命令资源请求被满足时，直接在提交作业的结点执行相应任务。而 <code>sbatch</code> 则当资源请求被满足时，在分配的第一个结点上执行相应任务。</p></li> <li><p><code>salloc</code>提交的作业，如果需要关闭客户端，请重定向输入输出，并后台提交。</p></li></ol></blockquote> <h3 id="作业提交举例"><a href="#作业提交举例" class="header-anchor">#</a> 作业提交举例</h3> <p>以编写 <code>sub.sh</code> 作业提交脚本，通过 <code>sbatch</code> 命令提交的方式为例，介绍常见的作业提交方式。</p> <h4 id="串行程序"><a href="#串行程序" class="header-anchor">#</a> 串行程序</h4> <p>用户可执行文件为 <code>a.out</code>，串行程序只能使用 <code>1</code> 个计算核心。编写提交脚本 <code>sub.sh</code> 如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
srun -N <span class="token number">1</span> n <span class="token number">1</span> -p batch ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用 <code>sbatch</code> 命令提交：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch -N <span class="token number">1</span> -n <span class="token number">1</span> -p batch ./sub.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="多线程程序"><a href="#多线程程序" class="header-anchor">#</a> 多线程程序</h4> <p>假设用户程序支持多线程（例如openMP方式），其可执行文件为 <code>a.out</code> ，需使用 80 个 <code>openMP</code> 多线程并行计算。编写提交脚本 sub.sh 如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">OMP_NUM_THREADS</span><span class="token operator">=</span><span class="token number">80</span>
srun -N <span class="token number">1</span> -n <span class="token number">1</span> -c <span class="token number">80</span> -p batch ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用 <code>sbatch</code> 命令提交：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch -N <span class="token number">1</span> -n <span class="token number">1</span> -p batch ./sub.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id=""><a href="#" class="header-anchor">#</a></h4> <h4 id="mpi程序-srun方式"><a href="#mpi程序-srun方式" class="header-anchor">#</a> MPI程序（srun方式）</h4> <p>假设用户可执行文件为 <code>a.out</code>，需使用 <code>160</code> 个进程并行计算，编写提交脚本 <code>sub.sh</code> 如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
srun -N <span class="token number">2</span> -n <span class="token number">160</span> -p batch ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用 <code>sbatch</code> 命令提交：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch -n <span class="token number">24</span> -p debug sub.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>Tips：<code>sbatch</code> 申请的资源必须<strong>大于或等于（推荐）</strong><code>sub.sh</code> 脚本中<code>srun</code>申请的资源。</p></blockquote> <h4 id="mpi程序-mpirun方式"><a href="#mpi程序-mpirun方式" class="header-anchor">#</a> MPI程序（mpirun方式）</h4> <p>如果用户自行编译 <code>MPI</code> 并且没有支持 <code>slurm</code>作业调度系统接口，那么在提交并行任务时，只能使用 <code>mpirun</code> 命令运行。</p> <p>假设用户可执行文件为 <code>a.out</code>，需使用 <code>160</code> 个进程并行计算，编写提交脚本 <code>sub.sh</code> 如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
srun -N <span class="token number">2</span> -n <span class="token number">160</span> -p batch <span class="token function">hostname</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token operator">&gt;</span> hostlist
mpirun -N <span class="token number">2</span> -n <span class="token number">160</span> -hostfile hostlist ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用 <code>sbatch</code> 命令提交：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch -N <span class="token number">2</span> -n <span class="token number">160</span> -p batch ./sub.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="mpi-多进程程序"><a href="#mpi-多进程程序" class="header-anchor">#</a> MPI + 多进程程序</h4> <p>如果用户的程序支持该并行方式，若用户可执行文件为 <code>a.out</code>，需使用 <code>40</code> 个MPI进程并行计算，每个进程下开启 <code>8</code> 个 <code>openMP</code> 线程，则应使用的计算结点数为  <code>40 * 8 / 80 = 4</code>。编写提交脚本 <code>sub.sh</code> 如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bashexport OMP_NUM_THREADS=6srun-N 12 -n 24 -c 6 -p debug a.out</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 <code>sbatch</code> 命令提交：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch -N <span class="token number">4</span> -n <span class="token number">40</span> -p batch ./sub.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>Tips：结点数 = 40个MPI进程 *****  8个openMP线程/进程 <strong>/</strong>  80个CPU核心/结点</p></blockquote> <h4 id="另一种格式的脚本"><a href="#另一种格式的脚本" class="header-anchor">#</a> 另一种格式的脚本</h4> <p>用户可以编译一个包含 <code>SBATCH</code> 命令参数的脚本，然后在使用 <code>sbatch</code> 提交任务时，仅给出脚本名称即可。举例如下：</p> <p>编写一个脚本文件 <code>sub.sh</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#SBATCH -J helloworld</span>
<span class="token comment">#SBATCH -p batch</span>
<span class="token comment">#SBATCH -N 4</span>
<span class="token comment">#SBATCH -n 160</span>
<span class="token comment">#SBATCH -o %j.out</span>
<span class="token comment">#SBATCH -e %j.err</span>

srun ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>或者</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#SBATCH --job-name=helloworld</span>
<span class="token comment">#SBATCH --partition=batch</span>
<span class="token comment">#SBATCH --nodes=4</span>
<span class="token comment">#SBATCH --ntasks=160</span>
<span class="token comment">#SBATCH --output=%j.out</span>
<span class="token comment">#SBATCH --error=%j.err</span>

srun ./a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>然后直接运行提交脚本的命令即可：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sbatch sub.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="作业取消"><a href="#作业取消" class="header-anchor">#</a> 作业取消</h3> <p>用户可以使用 <code>scancel</code> 命令取消自己的作业或作业步。</p> <p><code>scancel</code> 命令格式为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>scancel jobid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>举例如下：</strong></p> <p>如果提交作业后，如果正常结束，那么在<code>slurm-jobid.out</code>文件中并不会有任务的报错信息。</p> <p>如果任务已经提交，想将它取消，可以使用 <code>yhcancel</code> 命令，步骤如下：</p> <p>1）确定任务编号</p> <p>我们用<code>yhq</code>命令查看任务编号，比如为</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>     JOBID    PARTITION        NAME     <span class="token environment constant">USER</span>    ST  TIME      NODES NODELIST<span class="token punctuation">(</span>REASON<span class="token punctuation">)</span>
    <span class="token number">123456</span>        batch      sub.sh     zhang3  R   00:15:00  <span class="token number">2</span>     cn<span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2）通过任务编号取消任务</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>scancel <span class="token number">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>执行 <code>scancel</code> 时候发生了什么：</strong></p> <ul><li><p>对于排队作业，取消作业将简单地把作业标记为 <code>CANCELLED</code> 状态而结束作业。</p></li> <li><p>对于运行中或挂起的作业，取消作业将终止作业的所有作业步，包括批处理作业脚本，将作业标记为 <code>CANCELLED</code> 状态，并回收分配给作业的结点。一般地：</p> <ul><li>批处理作业将会马上终止；</li> <li>交互作业的 <code>srun</code> 进程将会感知到任务的退出而终止；</li> <li>分配模式作业的<code>salloc</code> 进程不会自动退出，除非作业所执行的用户命令因作业或任务的结束而终止。但是在作业被取消时，控制进程都会发送通知消息给分配资源的 <code>srun</code> 或 <code>salloc</code> 进程。</li></ul></li></ul></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/manual/use/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">02.使用方式</div></a> <a href="/manual/support/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">04.技术支持</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/manual/use/" class="prev">02.使用方式</a></span> <span class="next"><a href="/manual/support/">04.技术支持</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:pandagavin@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/pandagvin" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2021
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;width:160px;height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.001d7717.js" defer></script><script src="/assets/js/2.f6aa4a05.js" defer></script><script src="/assets/js/7.29ca4f21.js" defer></script>
  </body>
</html>